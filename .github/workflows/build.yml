name: Convertir Py a Exe y Zipear

on:
  push:
    branches: [ "main" ]
  workflow_dispatch: # Permite ejecutarlo manualmente desde la pestaña Actions

jobs:
  build:
    runs-on: windows-latest # Usamos Windows para generar un .exe nativo

    steps:
    # 1. Descargar el código del repositorio
    - name: Checkout del código
      uses: actions/checkout@v4

    # 2. Instalar Python
    - name: Configurar Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10' 

    # 3. Instalar PyInstaller y dependencias
    - name: Instalar dependencias
      run: |
        python -m pip install --upgrade pip
        pip install pyinstaller
        # Si tienes un requirements.txt, descomenta la siguiente línea:
        # pip install -r requirements.txt

    # 4. Crear el ejecutable (.exe)
    - name: Compilar con PyInstaller
      run: |
        # --onefile: Crea un solo archivo .exe
        # --noconsole: (Opcional) Úsalo si es una app con interfaz gráfica y no quieres la ventana negra
        pyinstaller --onefile main.py

    # 5. Comprimir con contraseña usando 7-Zip
    # 7z viene preinstalado en windows-latest
    - name: Crear ZIP con contraseña
      run: |
        cd dist
        7z a -tzip -p123 AplicacionProtegida.zip main.exe

    # 6. Subir el archivo resultante para que lo puedas descargar
    - name: Subir Artefacto
      uses: actions/upload-artifact@v4
      with:
        name: Resultado-Final
        path: dist/AplicacionProtegida.zip
